---
title: 浏览器缓存
date: 2021-04-02 16:59:22
tags: 缓存
---

浏览器缓存分为**强缓存**和**协商缓存**

<!--more-->

## 强缓存

强缓存是客户端对服务器上一次返回的响应头中的`cache-control`和`expires`进行时间判断，如果未过期，则使用已缓存资源，如果过期了，执行协商缓存策略。

|     字段      |                  实例                  | 优先级 | HTTP 版本 |
| :-----------: | :------------------------------------: | :----: | :-------: |
|    Pragma     |     pragma: no-cache（只有这个值）     |  更高  |    1.0    |
| Cache-Control |       cache-control: max-age=60        |   高   |    1.1    |
|    Expires    | expires: Mon, 28 Mar 2022 21:37:27 GMT |   低   |    1.0    |

### Cache-Control 特殊指令

- `no-cache`把请求提交给服务器，进行协商缓存验证
- `no-store`不进行任何缓存操作

## 协商缓存

协商缓存是客户端和服务器进行协商是否使用缓存，从而判断是重新加载资源（200）还是使用本地缓存（304）

|       字段        |     对应字段      |      值       |                   含义                   | 优先级 |
| :---------------: | :---------------: | :-----------: | :--------------------------------------: | ------ |
|       Etag        |   If-None-Match   | hash/文件信息 | 服务器资源文件信息或文件内容生成的哈希值 | 高     |
|   If-None-Match   |       Etag        | hash/文件信息 |           上次响应头中的 Etag            | 高     |
|   Last-Modified   | If-Modified-Since |     时间      |          服务器资源最后修改时间          | 低     |
| If-Modified-Since |   Last-Modified   |     时间      |       上次响应头中的 Last-Modified       | 低     |

### Etag

Etag 是被请求资源的摘要标识，可以使服务器识别出内容是否被修改过

Nginx 生成 Etag 是由 `last_modified` 和 `content_length` ，比如 `W/"6062c869-5ade"`，由 十六进制的上次修改时间戳（秒级） 和 十六进制的文件大小 组合而成的。

要注意的是，Nginx 的方案并不能保证文件有修改，Etag 一定会发生改变，因为存在一种情况是在 1 秒内修改了文件，但是文件大小并没有改变，这时候 Etag 是没有变化的。但是这种情况极少发生，并且考虑到性能较高，依然采用了这种方案。
